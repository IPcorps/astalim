<div align="center">

[![English](https://img.shields.io/badge/-English-blue)](/../../)
# ASync TAsk LIMiter
_(–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è.)_
</div>

<h1 align="center">–®–∞–±–ª–æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h1>

```ts
import astalim from "astalim"

// –ö–æ–ª-–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞–Ω–∏–π
const limit: number = 5

// –°–æ–∑–¥–∞–µ–º –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
const tasks = astalim.tasks_async(limit)

// –í —Ü–∏–∫–ª–µ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
for (const path of <paths>) {
  await tasks.addTask(async () => {
    ...
    <–ö–∞–∫–∞—è-–ª–∏–±–æ —Ä–∞–±–æ—Ç–∞ —Å –æ—á–µ—Ä–µ–¥–Ω—ã–º path>
    ...
  })
}

// –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
const results = await tasks.waitResult()
```

<h1 align="center">–ü–æ–¥—Ä–æ–±–Ω–µ–π –ø–æ —ç—Ç–∞–ø–∞–º</h1>

# 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
```ts
const tasks = astalim.tasks_async(limit: number)
```
–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **limit** –∑–∞–¥–∞—á.

# 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á
```ts
for (const path of <paths>) {
  await tasks.addTask(async () => {
    ...
    <–ö–∞–∫–∞—è-–ª–∏–±–æ —Ä–∞–±–æ—Ç–∞ —Å –æ—á–µ—Ä–µ–¥–Ω—ã–º path>
    ...
  })
}
```
–í –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ **addTask** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏–±–æ **Promise**, –ª–∏–±–æ —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **Promise**. –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞, –æ—á–µ—Ä–µ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞—á–Ω–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è, –ø–æ–∫–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –º–µ—Å—Ç–æ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏ –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—É–ª.

**üî¥ –í–ê–ñ–ù–û:** –ß—Ç–æ –±—ã –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –∑–∞–¥–∞—á–µ, –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –í—Å–µ –≤–æ–∑–Ω–∏–∫—à–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–æ—à–∏–±–∫–∏) —Ç–∏—Ö–æ –±—É–¥—É—Ç –∑–∞–ø–∏—Å–∞–Ω—ã –≤ –æ–±—â–∏–π –º–∞—Å—Å–∏–≤ –æ—à–∏–±–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

# 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```ts
const results = await tasks.waitResult()
```
–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –û–±—ä–µ–∫—Ç **results** —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ –º–∞—Å—Å–∏–≤–∞:
* **successful**: –º–∞—Å—Å–∏–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á,
* **failed**: –º–∞—Å—Å–∏–≤ –æ—à–∏–±–æ–∫, –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–π—Å—Ç–≤–∞:
  * **error**: —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏,
  * **index**: —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞–¥–∞—á–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–æ–∏–∑–æ—à–ª–∞ –¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞.

‚ö†Ô∏è –¢–∞–∫ –∂–µ –≤—ã–∑–æ–≤ **waitResult()** —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ—ç—Ç–æ–º—É –¥–∞–ª–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á **addTask()** –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è **tasks**.

–í–æ–∑–º–æ–∂–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã:
1. –ù–µ –≤–∞–∂–µ–Ω –∏ –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ —Å–ø–∏—Å–∫—É, –∫–æ–≥–¥–∞ –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞, –∏ –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—É—Å—Ç–∏—Ç—å –≤—ã–∑–æ–≤ **waitResult()** –∏ –¥–∞—Ç—å –∑–∞–¥–∞—á–∞–º —Ç–∏—Ö–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –≤ —Ñ–æ–Ω–µ. üî¥ –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –¥–∞–ª–µ–µ –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç **tasks**, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—É—â–∏–π **tasks** –∫ —Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É –≤–ø–æ–ª–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—â–µ –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.
2. –ù–µ –≤–∞–∂–µ–Ω –ª–∏—à—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–¥–∞—á, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **await tasks.waitResult()** –±–µ–∑ –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

<h1 align="center">–ü—Ä–∏–º–µ—Ä</h1>

```ts
import astalim from "astalim"

// –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —Å –ø—É–ª–æ–º –≤ 3 –∑–∞–¥–∞—á–∏
const tasks = astalim.tasks_async(3)

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Å–µ–≤–¥–æ—Å–æ–±—ã—Ç–∏–π
function* randGen() {
  let i = 0
  while (i++ < 10) yield Math.random()
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á
for (const rand of randGen()) {
  await tasks.addTask(async () => {
    // –£–¥–∞—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    if (rand > .5) return rand
    // –ù–µ—É–¥–∞—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –≤—ã–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    else JSON.parse("") // OR else throw `Error: ${rand}`
  })
}

// –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
const results = await tasks.waitResult()

console.log("results:", results)
```
–í—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–æ–±–µ–Ω —Å–ª–µ–¥—É—é—â–µ–º—É:
```
results: {
  successful: [
    0.5774501276332757,
    0.8140335738582891,
    0.9180485044161926,
    0.9421955524500936,
    0.8163302889107125,
    0.8032588867553216,
    0.783284406112269
  ],
  failed: [
    {
      error: SyntaxError: Unexpected end of JSON input
          at JSON.parse (<anonymous>)
          ...
      index: 1
    },
    {
      error: SyntaxError: Unexpected end of JSON input
          at JSON.parse (<anonymous>)
          ...
      index: 2
    },
    {
      error: SyntaxError: Unexpected end of JSON input
          at JSON.parse (<anonymous>)
          ...
      index: 4
    }
  ]
}
```
